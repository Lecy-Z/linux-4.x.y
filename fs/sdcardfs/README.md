## sdcardfs

sdcardfs的作用与fuse相同，也是用于控制文件访问的权限。sdcardfs的工作方式是把内置SD卡目录挂载到用于权限控制目录。对内置SD卡的系统调用，先经过sdcardfs，然后把访问路径改为ext4文件系统的真正路径，再到达ext4文件系统。ext4执行完以后，把结果返回给sdcardfs，再返回给调用者。

对比fuse和sdcardfs，对同一个文件访问，fuse需要经过6次用户态与内核态的切换，但是sdcardfs只需要经过2次切换。另外fuse在内核中有多个队列，队列中元素的出列要等前面的元素先出列。因此单次文件访问，fuse比sdcardfs需要更多的时间。但是，不管是fuse，还是sdcardfs，对文件的单次访问，大部分情况下时间是很短的，人从感官上无法区分。而对于耗时的文件读写操作的时间来说，上述多出来的时间微不足道。而真正访问时间差异在来源于量变引起质变。当需要进行大量的文件访问时，累积产生时间差异是可以明显感觉出来的。其次需要注意下SDcardfs和Fuse都是大小写不敏感的。SDcard由于减少了用户态与内核态的切换，其理论性能会十分接近真实系统系统。

### SDcardFS与WrapFS

sdcardfs，是三星wrapfs改写而成。由于关于sdcardfs的介绍较少，简单说明下wrapfs架构，二者之间架构类似。关于WrapFS介绍可参考魅族的内核团队博客

WrapFS 是一种堆栈式文件系统，堆栈式文件系统的一个基本功能就是把操作和参数转换成底层文件系统的操作和参数。这就意味着我们会在 WrapFS 层上创建一个文件对象后会在底层文件对应着创建一个对象，要说明的是，WrapFS 层的这个文件对象只保存在内存里面，断电后会消失，真正文件里面的数据保存在底层文件系统里面.

[WrapFS](./wrapfs.gif)

WrapFS 优势:

* WrapFS 是一种理想的小模板，可以修改，逐步改造出新的文件系统功能。
* WrapFS 可以当作一种方法，用于测试 Linux VFS 超强的堆叠能力。
* WrapFS 可以当作学习 VFS，或学习如何写新的 Linux 文件系统的一个好工具。

在 Android 里面，采用的是 FUSE 文件系统，FUSE 文件系统的最终实现是在用户空间，这样导致一个文件操作会两次跨越用户空间和内核空间，导致效率降低，但是 WrapFS 不会有这个问题，其性能接近底层文件系统的实际性能.
