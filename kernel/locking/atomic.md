# atomic

内核定义了atomic_t数据类型（在<asm-arch/atomic.h>中），用作对整数计数器的原子操作的基础。从内核的角度来看，这些操作的执行仿佛是一条汇编语句。这里给出一个简短的例子，将计数器加1，即足以说明此类操作的必要性。
在汇编语言中，加1操作通常分为3步执行：
*（1）将计数器值从内存复制到处理器寄存器；
*（2）将其值加1；
*（3）将寄存器数据回写到内存。
如果有另一个处理器同时执行该操作，则会发生问题。两个处理器同时从内存读取计数器的值（例如4），将其加1得到5，最后将新数值回写到内存。但如果操作正确，内存中的值应该是6，因为计数器的加1操作执行了两次。内核支持的所有处理器，都提供了原子执行此类操作的手段。
一般说来，可使用特殊的锁指令阻止系统中其他处理器工作，直至当前处理器完成下一个操作为止。也可以使用效果相同的等价机制。